#include <stdio.h>
#include <stdlib.h>

// Embed binary payload into host file
void embed_binary_payload(const char *host_file_path, const unsigned char *binary_payload, size_t binary_payload_size, const char *output_file_path) {
    // Open host file for reading
    FILE *host_file = fopen(host_file_path, "rb");
    if (!host_file) {
        perror("Error opening host file");
        exit(EXIT_FAILURE);
    }

    // Open output file for writing
    FILE *output_file = fopen(output_file_path, "wb");
    if (!output_file) {
        perror("Error opening output file");
        fclose(host_file);
        exit(EXIT_FAILURE);
    }

    // Read host file and write to output file
    unsigned char buffer[4096];
    size_t bytes_read;
    while ((bytes_read = fread(buffer, 1, sizeof(buffer), host_file)) > 0) {
        fwrite(buffer, 1, bytes_read, output_file);
    }

    // Append binary payload to output file
    fwrite(binary_payload, 1, binary_payload_size, output_file);

    // Close files
    fclose(host_file);
    fclose(output_file);

    // Print completion message
    printf("Binary payload embedded into %s\n", output_file_path);
}

int main() {
    // Define the binary payload and its size
    unsigned char new_payload[] = {/* payload binary data here */};
    size_t new_payload_size = sizeof(new_payload);

    // File paths for host and output files
    const char *host_file_path = "path/to/host_file.pdf"; // Update path as needed
    const char *output_file_path = "path/to/output_file.pdf"; // Update path as needed

    // Call function to embed binary payload
    embed_binary_payload(host_file_path, new_payload, new_payload_size, output_file_path);

    return 0;
}
